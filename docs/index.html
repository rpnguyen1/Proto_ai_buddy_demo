<!DOCTYPE html>
<html>
<body>

<h3>Local Plush Backend Test</h3>

<input id="code" placeholder="enter passcode">
<button onclick="sendTest()">Submit</button>

<p id="result"></p>

<h2>Mic and Speaker Test + Turn on Mic and Speakers</h2>

<button id="recordBtn">Start Recording</button>
<p id="status"></p>
<audio id="player" controls></audio>








<script>
async function sendTest() {
    const passcode = document.getElementById("code").value;

    // const res = await fetch("http://localhost:5001/api/test", {
    const res = await fetch("https://proto-ai-buddy-backend.onrender.com/api/test", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ passcode })
    });

    const data = await res.json();
    // document.getElementById("result").textContent = data.message;
    if (data.ok) {
    window.location.href =
        "https://proto-ai-buddy-backend.onrender.com/app?t=" + passcode;
    } else {
        document.getElementById("result").textContent = data.message;
    }
}



let recording = false;
let mediaRecorder;
let chunks = [];

document.getElementById("recordBtn").onclick = async () => {
    if (!recording) {
        // start recording
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        chunks = [];
        mediaRecorder.ondataavailable = e => chunks.push(e.data);

        mediaRecorder.start();
        recording = true;

        document.getElementById("status").textContent = "Recording...";
        document.getElementById("recordBtn").textContent = "Stop Recording";

    } else {
        // stop recording
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: "audio/webm" });
            const url = URL.createObjectURL(blob);
            document.getElementById("player").src = url;

            document.getElementById("status").textContent = "Recording complete.";
        };
        mediaRecorder.stop();
        recording = false;

        document.getElementById("recordBtn").textContent = "Start Recording";
    }
};





</script>

</body>
</html>
